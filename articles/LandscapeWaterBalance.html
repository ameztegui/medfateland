<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landscape water balance â€¢ medfateland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Landscape water balance">
<meta property="og:description" content="medfateland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="LandscapeWaterBalance_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Landscape water balance</h1>
                        <h4 class="author">Miquel De Caceres</h4>
            
            <h4 class="date">2021-07-14</h4>
      
      
      <div class="hidden name"><code>LandscapeWaterBalance.Rmd</code></div>

    </div>

    
    
<div id="simulations-on-a-set-of-forest-stands" class="section level2">
<h2 class="hasAnchor">
<a href="#simulations-on-a-set-of-forest-stands" class="anchor"></a>Simulations on a set of forest stands</h2>
<p>Package <code>medfate</code> include functions <code><a href="https://rdrr.io/pkg/medfate/man/spwb.html">spwb()</a></code> or <code><a href="https://rdrr.io/pkg/medfate/man/growth.html">growth()</a></code> to simulate soil water balance on a single forest stand. This section describes how to run simulations on a set of forest stands in one call. This is done using functions <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code>, <code><a href="../reference/medfate%20spatial.html">spwbpixels()</a></code>, <code><a href="../reference/medfate%20spatial.html">spwbgrid()</a></code> and the corresponding growth functions.</p>
<p>As an example, we will use function <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code>, which simulates soil plant water balance on forests distributed in particular locations. The function takes an object of class <code>SpatialPointsLandscape</code> as input. We begin by loading an example dataset of 30 forest stands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"examplepointslandscape"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">examplepointslandscape</span><span class="op">)</span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-1-1.png" width="480" style="display: block; margin: auto;"></p>
<p>As before, we need meteorological data, species parameters and control parameters (which will apply to all forest stands):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"examplemeteo"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span>
<span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/medfate/man/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">control</span><span class="op">$</span><span class="va">verbose</span> <span class="op">=</span> <span class="cn">FALSE</span></code></pre></div>
<p>The call to <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> can be done as follows (here we restrict the dates for simplicity):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-15"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/medfate%20spatial.html">spwbpoints</a></span><span class="op">(</span><span class="va">examplepointslandscape</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, 
                  dates <span class="op">=</span> <span class="va">dates</span>, control <span class="op">=</span> <span class="va">control</span>,  progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Function <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> first initializes model inputs by calling <code><a href="https://rdrr.io/pkg/medfate/man/modelInput.html">forest2spwbInput()</a></code> for each forest stand described in the <code>SpatialPointsLandscape</code> object. Then it calls function <code><a href="https://rdrr.io/pkg/medfate/man/spwb.html">spwb()</a></code> for each forest stand and stores the result. The fact that we used <code>examplemeteo</code> as meteorological input involves that the same weather was applied to all forest stands, but different weather could have been specified for each one (see documentation of function <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code>).</p>
<p>The result of calling <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> is a list (whose class name is the same as the function name) with the following elements:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "coords"      "bbox"        "proj4string" "xlist"       "reslist"</code></pre>
<p>Apart from those elements describing spatial information, vector <code>xlist</code> contains the <code>spwbInput</code> corresponding to each forest stand, and vector <code>reslist</code> contains the output of <code><a href="https://rdrr.io/pkg/medfate/man/spwb.html">spwb()</a></code> function for each forest stand (i.e.Â elements of <code>reslist</code> are objects of an S3 class with the same name). This structure of the output of <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> allows querying information for the simulation of any particular forest stand. For example, if we want a monthly summary of water balance for the first stand, we can use function <code><a href="https://rdrr.io/pkg/medfate/man/plot.spwb.html">summary.spwb()</a></code> from package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">reslist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">sum</span>, 
        output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></code></pre></div>
<pre><code>##                PET Precipitation     Rain Snow  NetRain Snowmelt Infiltration
## 2001-03-01 39.8194      67.79528 67.79528    0 53.42201        0     52.31339
##              Runoff DeepDrainage Evapotranspiration Interception
## 2001-03-01 1.108623     42.07719           27.78286     14.37327
##            SoilEvaporation PlantExtraction Transpiration
## 2001-03-01        3.383705        10.02589      10.02589</code></pre>
<p>If one needs to save memory, it is possible with <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> to generate summaries automatically after the simulation of soil water balance of each stand, and storing those summaries instead of all the output of <code><a href="https://rdrr.io/pkg/medfate/man/spwb.html">spwb()</a></code>. For example the following code will produce the same output as before:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/medfate%20spatial.html">spwbpoints</a></span><span class="op">(</span><span class="va">examplepointslandscape</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, 
                  dates <span class="op">=</span> <span class="va">dates</span>, control <span class="op">=</span> <span class="va">control</span>,  progress <span class="op">=</span> <span class="cn">FALSE</span>,
                  summaryFunction <span class="op">=</span> <span class="va">summary.spwb</span><span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">reslist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>##                PET Precipitation     Rain Snow  NetRain Snowmelt Infiltration
## 2001-01-01 39.8194      67.79528 67.79528    0 53.42201        0     52.31339
##              Runoff DeepDrainage Evapotranspiration Interception
## 2001-01-01 1.108623     42.07719           27.78286     14.37327
##            SoilEvaporation PlantExtraction Transpiration
## 2001-01-01        3.383705        10.02589      10.02589</code></pre>
</div>
<div id="simulation-of-watershed-hydrology" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-of-watershed-hydrology" class="anchor"></a>Simulation of watershed hydrology</h2>
<p>Simulation of watershed hydrology involves describing a watershed in a gridded mode and simulating soil water balance water while including additional compartments and hydrological processes, such as routing runoff from one cell to the other. To illustrate this kind of simulation, which is carried out using function <code><a href="../reference/wswb.html">wswb()</a></code>, we first load a small example watershed included with the package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"examplewatershed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">examplewatershed</span>, <span class="st">"elevation"</span><span class="op">)</span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>As for the call to function <code><a href="../reference/medfate%20spatial.html">spwbpoints()</a></code> we will use the same weather (i.e.Â <code>examplemeteo</code>) across the watershed. To speed up calculations we call function <code><a href="../reference/wswb.html">wswb()</a></code> for a single month.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-31"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/wswb.html">wswb</a></span><span class="op">(</span><span class="va">examplewatershed</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, dates <span class="op">=</span> <span class="va">dates</span>, summaryFreq <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ------------  wswb ------------
## Grid cells: 66, patchsize: 10000 m2, area: 66 ha
## Cell land use wildland: 48 agriculture: 17 artificial: 0 rock: 1 water: 0
## Cells with soil: 65
## Meteorological input class: data.frame
## Number of days to simulate: 31
## Number of summaries: 1
## Number of outlet cells: 1
## 
## Preparing spwb input:
## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |======================================================================| 100%
## 
## Initial average soil water content (mm): 530.8
## Initial average snowpack water content (mm): 0
## Initial average aquifer water content (mm): 0
## Initial watershed water content (mm): 522.76
## 
## Performing daily simulations:
## .+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++done
## 
## Final average soil water content (mm): 530.8
## Final average snowpack water content (mm): 0
## Final average aquifer water content (mm): 45.31
## Final watershed water content (mm): 568.07
## 
## Change in snowpack water content (mm): 0
## Snowpack water balance result (mm): 0
## Snowpack water balance components:
##   Snow fall (mm) 9.77 Snow melt (mm) 9.77
## 
## Change in soil water content (mm): 0
## Soil water balance result (mm): -2.27
## Soil water balance components:
##   Net rainfall (mm) 48.47 Snow melt (mm) 9.77
##   Runon (mm) 1.15 Runoff (mm) 0
##   Subsurface input (mm) 0  Subsurface output (mm) 0
##   Deep drainage (mm) 46.01 Aquifer discharge (mm) 0
##   Soil evaporation (mm) 7.28 Plant transpiration (mm) 8.37
## 
## Change in aquifer water content (mm): 45.31
## Aquifer water balance result (mm): 45.31
## Aquifer water balance components:
##   Deep drainage (mm) 45.31 Aquifer discharge (mm) 0
## 
## Change in watershed water content (mm): 45.31
## Watershed water balance result (mm): 43.07
## Watershed water balance components:
##   Precipitation (mm) 74.75
##   Interception (mm) 16.26 Soil evaporation (mm) 7.17 Plant Transpiration (mm) 8.24
##   Export (mm) 0
## Watershed lateral flows:
##   Subsurface flow (mm) 0
##   Groundwater flow (mm) 8.66
## 
## ------------  wswb ------------</code></pre>
<p>Although simulations are performed using daily temporal steps, parameter <code>summaryFreq</code> allows storing results at coarser temporal scales, to reduce the amount of memory in spatial results. Several plots can be drawn from the result of function <code><a href="../reference/wswb.html">wswb()</a></code>. As an example we display a map of average soil water potential for the simulated month.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"Psi1"</span><span class="op">)</span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Miquel De CÃ¡ceres.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
